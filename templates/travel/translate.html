{% extends "travel/base.html" %}
{% block title %}Translate{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">ğŸˆ¯ ë²ˆì—­</h1>

<div class="grid md:grid-cols-2 gap-6">
  <!-- ì…ë ¥ í¼ -->
  <form method="post" class="bg-white rounded-2xl shadow p-5 space-y-4">
    {% csrf_token %}

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1">ì›ë¬¸ ì–¸ì–´</label>
        <select name="src" class="input">
          <option value="ìë™ê°ì§€" {% if request.POST.src == "ìë™ê°ì§€" %}selected{% endif %}>ìë™ê°ì§€</option>
          <option value="ko" {% if request.POST.src == "ko" %}selected{% endif %}>ko</option>
          <option value="en" {% if request.POST.src == "en" %}selected{% endif %}>en</option>
          <option value="ja" {% if request.POST.src == "ja" %}selected{% endif %}>ja</option>
          <option value="zh" {% if request.POST.src == "zh" %}selected{% endif %}>zh</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">ë²ˆì—­ ì–¸ì–´</label>
        <select name="tgt" class="input">
          <option value="ko" {% if request.POST.tgt == "ko" %}selected{% endif %}>ko</option>
          <option value="en" {% if request.POST.tgt == "en" or not request.POST.tgt %}selected{% endif %}>en</option>
          <option value="ja" {% if request.POST.tgt == "ja" %}selected{% endif %}>ja</option>
          <option value="zh" {% if request.POST.tgt == "zh" %}selected{% endif %}>zh</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium mb-1">ë§íˆ¬</label>
        <select name="tone" class="input">
          <option value="ì¤‘ë¦½" {% if request.POST.tone == "ì¤‘ë¦½" or not request.POST.tone %}selected{% endif %}>ì¤‘ë¦½</option>
          <option value="ê²©ì‹" {% if request.POST.tone == "ê²©ì‹" %}selected{% endif %}>ê²©ì‹</option>
          <option value="ì¹œê·¼" {% if request.POST.tone == "ì¹œê·¼" %}selected{% endif %}>ì¹œê·¼</option>
        </select>
      </div>
    </div>

    <div>
      <label class="block text-sm font-medium mb-1">ì›ë¬¸</label>
      <textarea
        name="text"
        class="input"
        style="width:100%;max-width:100%;min-height:260px;"
        placeholder="ë²ˆì—­í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”"
      >{{ request.POST.text }}</textarea>
    </div>

    <!-- ëª¨ë¸ ì„ íƒ -->
    <div>
      <label class="block text-sm font-medium mb-1">ëª¨ë¸ ì œê³µì‚¬</label>
      <select name="provider" id="provider" class="input">
        <option value="openai" {% if provider == "openai" or not provider %}selected{% endif %}>OpenAI</option>
        <option value="gemini" {% if provider == "gemini" %}selected{% endif %}>Google Gemini</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">ì„¸ë¶€ ëª¨ë¸</label>
      <select name="model" id="model" class="input"></select>
      <small class="muted">ê³„ì •/ì‹œì ì— ë”°ë¼ ì¼ë¶€ ëª¨ë¸ì€ ë¯¸ì§€ì›ì¼ ìˆ˜ ìˆì–´ìš”.</small>
    </div>

    <button class="btn-primary w-full">ë²ˆì—­í•˜ê¸°</button>
  </form>

  <!-- ê²°ê³¼ -->
  <section class="bg-white rounded-2xl shadow p-5" id="translate-result">
    <h3 class="font-semibold mb-3">ë²ˆì—­ ê²°ê³¼</h3>
    {% if result %}
      <div class="whitespace-pre-line text-lg">{{ result }}</div>
    {% else %}
      <p class="text-slate-500">ì™¼ìª½ì— ì›ë¬¸ì„ ì…ë ¥í•˜ê³  <b>ë²ˆì—­í•˜ê¸°</b>ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
    {% endif %}
  </section>
</div>

<!-- ëª¨ë¸ ëª©ë¡ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const SELECTED = {
    provider: "{{ provider|default:'openai' }}",
    model: "{{ model|default:'' }}"
  };
  const MODEL_CATALOG = {
    openai: ["gpt-4o-mini","gpt-4.1-mini","gpt-4.1","gpt-4o","gpt-5"],
    gemini: ["gemini-1.5-flash","gemini-1.5-pro","gemini-1.5-flash-8b"]
  };
  function fillModels() {
    const prov = document.getElementById('provider');
    const modelSel = document.getElementById('model');
    if (!prov || !modelSel) return;
    const list = MODEL_CATALOG[prov.value] || [];
    modelSel.innerHTML = "";
    list.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m; opt.textContent = m;
      if (SELECTED.provider === prov.value && SELECTED.model === m) opt.selected = true;
      modelSel.appendChild(opt);
    });
    if (!modelSel.value && list.length) modelSel.value = list[0];
  }
  document.addEventListener('DOMContentLoaded', () => {
    const prov = document.getElementById('provider');
    if (prov) {
      prov.addEventListener('change', () => { SELECTED.model = ""; fillModels(); });
      fillModels();
    }
  });

  // âœ… ì±—ë´‡ í›„ì† ê²°ê³¼ ë°˜ì˜ìš©
  function updateTranslateUI(data){
    const box = document.getElementById("translate-result");
    if(!box) return;
    box.innerHTML = `<h3 class="font-semibold mb-3">ìˆ˜ì •ëœ ë²ˆì—­ ê²°ê³¼</h3>
                     <div class="whitespace-pre-line text-lg">${data.reply||""}</div>`;
  }
</script>
{% endblock %}
